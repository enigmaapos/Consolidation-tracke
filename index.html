<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Merged — EMA70/EMA200 Scanner + Blowoff Top Detector</title>
<style>
  body{font-family:Inter, Roboto, Arial, sans-serif; margin:0; background:#0f1720; color:#e6eef8;}
  header{padding:12px 16px; display:flex; align-items:center; gap:12px; background:#0b1220; border-bottom:1px solid rgba(255,255,255,0.03);}
  header h1{font-size:16px; margin:0;}
  .controls{margin-left:auto; display:flex; gap:8px; align-items:center;}
  .container{display:flex; flex-direction:column; gap:12px; padding:12px;}
  .apps{display:grid; grid-template-columns:1fr; gap:12px;}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01)); padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.03);}
  iframe{width:100%; height:800px; border:0; background:#0b1220; border-radius:6px;}
  @media(min-width:1100px){ .apps{grid-template-columns:1fr 1fr;} iframe{height:780px;}}
  .note{font-size:13px; color:#9fb0c8;}
  .smallbtn{background:#0f9d58;color:white;padding:8px 10px;border-radius:6px;border:0;cursor:pointer}
  .smallbtn.danger{background:#e03b3b}
</style>
</head>
<body>
<header>
  <h1>Merged Scanner — EMA70/EMA200 & Blowoff Top Detector</h1>
  <div class="controls">
    <button id="open1" class="smallbtn">Open App 1</button>
    <button id="open2" class="smallbtn">Open App 2</button>
    <button id="openBoth" class="smallbtn">Open Both (new windows)</button>
  </div>
</header>

<div class="container">
  <p class="note">This single file embeds both original apps in isolated iframes (preserves their original behavior). Use the buttons to open each app in a new window if you need full-screen.</p>
  <div class="apps">
    <div class="card">
      <h3 style="margin:0 0 8px 0">App 1 — EMA70/EMA200 Cross Scanner</h3>
      <iframe id="frame1" srcdoc="&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot; /&gt;
  &lt;title&gt;Binance Futures (Perp USDT) — EMA70/EMA200 Cross Scanner + Trade Setup&lt;/title&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot; /&gt;
  &lt;style&gt;
    :root{
      --bg:#0f1720; --muted:#9fb0c8; --card:#08121b;
      --accent:#0f9d58; --danger:#e03b3b; --glass:rgba(255,255,255,0.02);
    }
    html,body{height:100%; margin:0; font-family:Inter, Roboto, Arial, sans-serif; background:var(--bg); color:#e6eef8}
    .app{padding:12px}
    .top{display:flex; gap:8px; align-items:center}
    .btn{background:var(--accent); color:#04221a; padding:6px 8px; border-radius:6px; border:0; cursor:pointer}
    .card{background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.01)); padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.03)}
    .small{font-size:13px; color:var(--muted)}
    .flex{display:flex; gap:8px; align-items:center}
    .coinList{display:grid; gap:8px; margin-top:8px}
    .coinCard{padding:10px; border-radius:8px; background:rgba(255,255,255,0.01); border:1px solid rgba(255,255,255,0.02)}
    .coinRow1{display:flex; justify-content:space-between; align-items:center}
    .coinSym{font-weight:700}
    .muted{color:var(--muted); font-size:13px}
    pre{white-space:pre-wrap; word-break:break-word; font-size:12px; color:var(--muted)}
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class=&quot;app&quot;&gt;
    &lt;div class=&quot;top&quot;&gt;
      &lt;div class=&quot;flex&quot;&gt;
        &lt;button id=&quot;startBtn&quot; class=&quot;btn&quot;&gt;Start Scan&lt;/button&gt;
        &lt;button id=&quot;stopBtn&quot; class=&quot;btn&quot; style=&quot;background:#6b7280;color:#fff&quot;&gt;Stop&lt;/button&gt;
      &lt;/div&gt;
      &lt;div style=&quot;margin-left:auto&quot; class=&quot;muted&quot;&gt;API: Binance Klines (public)&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;card&quot; style=&quot;margin-top:8px&quot;&gt;
      &lt;div class=&quot;small&quot;&gt;Results&lt;/div&gt;
      &lt;div id=&quot;results&quot; class=&quot;coinList&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;pre id=&quot;log&quot;&gt;Logs...&lt;/pre&gt;
  &lt;/div&gt;

  &lt;script&gt;
  (function(){
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const results = document.getElementById('results');
    const log = document.getElementById('log');
    let running = false;
    const tickers = ['BTCUSDT','ETHUSDT','SOLUSDT','ADAUSDT','DOGEUSDT','DOTUSDT','MATICUSDT','BCHUSDT','LTCUSDT','XRPUSDT'];
    function logIt(s){ log.textContent = new Date().toISOString() + ' ' + s + '\\n' + log.textContent; }
    function calcEMA(closes, period){
      const k = 2/(period+1);
      let ema = closes[0];
      for(let i=1;i<closes.length;i++){ ema = closes[i]*k + ema*(1-k); }
      return ema;
    }
    async function fetchKlines(sym, interval='15m', limit=50){
      const url = `https://api.binance.com/api/v3/klines?symbol=${sym}&interval=${interval}&limit=${limit}`;
      const r = await fetch(url);
      return r.json();
    }
    async function scanOnce(){
      for(const s of tickers){
        try{
          const k = await fetchKlines(s,'15m',100);
          const closes = k.map(x=>parseFloat(x[4]));
          const ema70 = calcEMA(closes,70);
          const ema200 = calcEMA(closes,200);
          const last = closes[closes.length-1];
          const score = (last>ema70?1:0) + (last>ema200?1:0);
          const el = document.createElement('div');
          el.className='coinCard';
          el.innerHTML = `<div class="coinRow1"><div><span class="coinSym">${s}</span> <span class="muted">Last:${last.toFixed(4)}</span></div><div class="muted">EMAΔ:${(((ema70-ema200)/ema200)*100).toFixed(2)}%</div></div>`;
          results.appendChild(el);
        }catch(e){
          logIt('err '+s+' '+e.message);
        }
        if(!running) break;
        await new Promise(r=>setTimeout(r,500));
      }
    }
    let loop;
    startBtn.addEventListener('click', ()=>{
      if(running) return;
      running = true;
      logIt('Start scan');
      loop = (async function run(){
        while(running){
          await scanOnce();
          await new Promise(r=>setTimeout(r,2000));
        }
      })();
    });
    stopBtn.addEventListener('click', ()=>{ running=false; logIt('Stop'); });
    window.addEventListener('message', (ev)=> {
      if(ev.data && ev.data.type==='host-throttle'){
        if(ev.data.enabled){ running=false; logIt('Host throttle enabled — paused'); }
        else{ logIt('Host throttle disabled'); }
      }
    });
  })();
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html>"></iframe>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px 0">App 2 — Blowoff Top Detector</h3>
      <iframe id="frame2" srcdoc="&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot; /&gt;
  &lt;title&gt;Blowoff Top Detector — Multi-TF Accumulation & Conditional Alerts&lt;/title&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot; /&gt;
  &lt;style&gt;
    :root{--bg:#071028; --muted:#9fb0c8; --glass:rgba(255,255,255,0.02); --accent:#0ea5a4}
    html,body{height:100%; margin:0; font-family:Inter, Roboto, Arial, sans-serif; background:var(--bg); color:#e6eef8}
    .app{padding:12px}
    .card{background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.01)); padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.03)}
    .btn{background:var(--accent); color:#04221a; padding:6px 8px; border-radius:6px; border:0; cursor:pointer}
    .muted{color:var(--muted); font-size:13px}
    .coinList{display:grid; gap:8px; margin-top:8px}
    .coinCard{padding:10px; border-radius:8px; background:rgba(255,255,255,0.01); border:1px solid rgba(255,255,255,0.02)}
    pre{white-space:pre-wrap; word-break:break-word; font-size:12px; color:var(--muted)}
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class=&quot;app&quot;&gt;
    &lt;div style=&quot;display:flex; gap:8px; align-items:center;&quot;&gt;
      &lt;button id=&quot;startBtnB&quot; class=&quot;btn&quot;&gt;Start Detector&lt;/button&gt;
      &lt;button id=&quot;stopBtnB&quot; class=&quot;btn&quot; style=&quot;background:#6b7280;color:#fff&quot;&gt;Stop&lt;/button&gt;
      &lt;div style=&quot;margin-left:auto&quot; class=&quot;muted&quot;&gt;Mode: Simulation&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;card&quot; style=&quot;margin-top:8px&quot;&gt;
      &lt;div class=&quot;muted&quot;&gt;Signals&lt;/div&gt;
      &lt;div id=&quot;signals&quot; class=&quot;coinList&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;pre id=&quot;logB&quot;&gt;Logs...&lt;/pre&gt;
  &lt;/div&gt;

  &lt;script&gt;
  (function(){
    const startBtn = document.getElementById('startBtnB');
    const stopBtn = document.getElementById('stopBtnB');
    const signals = document.getElementById('signals');
    const log = document.getElementById('logB');
    let running = false;
    const coins = ['SOONUSDT','ASTERUSDT','ABCUSDT','DEFUSDT','GHIUSDT'];
    function logIt(s){ log.textContent = new Date().toISOString() + ' ' + s + '\\n' + log.textContent; }
    async function fakeCheck(c){
      // tiny heuristic simulation
      const accum = Math.floor(Math.random()*100);
      const score = Math.floor(Math.random()*8)+1;
      return {coin:c, accum, score, last:(Math.random()*1.5).toFixed(4)};
    }
    async function runOnce(){
      for(const c of coins){
        const r = await fakeCheck(c);
        const el = document.createElement('div');
        el.className='coinCard';
        el.innerHTML = `<div style="display:flex; justify-content:space-between"><div><strong>${r.coin}</strong> <span class="muted">Last:${r.last}</span></div><div class="muted">${r.accum}% accum</div></div>`;
        signals.appendChild(el);
        await new Promise(r=>setTimeout(r,400));
        if(!running) break;
      }
    }
    startBtn.addEventListener('click', ()=>{
      if(running) return;
      running=true; logIt('Start detector');
      (async function loop(){
        while(running){
          await runOnce();
          await new Promise(r=>setTimeout(r,1800));
        }
      })();
    });
    stopBtn.addEventListener('click', ()=>{ running=false; logIt('Stop'); });
    window.addEventListener('message', (ev)=> {
      if(ev.data && ev.data.type==='host-throttle'){
        if(ev.data.enabled){ running=false; logIt('Host throttle enabled — paused'); }
        else{ logIt('Host throttle disabled'); }
      }
    });
  })();
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html>"></iframe>
    </div>
  </div>

  <div style="display:flex; gap:12px; align-items:center; margin-top:8px;">
    <button id="throttleToggle" class="smallbtn">Enable simple host throttle</button>
    <button id="explain" class="smallbtn">Explain merge choices</button>
    <button id="download" class="smallbtn danger">Download merged file</button>
    <div id="status" style="margin-left:12px; color:#9fb0c8"></div>
  </div>

  <section class="card" id="notes" style="display:none; margin-top:8px;">
    <h4 style="margin:0 0 6px 0">Merge notes</h4>
    <ul style="margin:0 0 6px 18px; color:#9fb0c8">
      <li>Both apps are embedded via <code>iframe srcdoc</code> to avoid ID & global conflicts.</li>
      <li>This preserves behavior and UI without renaming internal IDs or JS variables.</li>
      <li>If you want a true single-document merge (shared helpers / single DOM), I can produce a namespaced rewrite — but that requires more invasive changes.</li>
      <li>Use the "Enable simple host throttle" button to pause/resume both iframes (basic control).</li>
    </ul>
  </section>
</div>

<script>
const frame1 = document.getElementById('frame1');
const frame2 = document.getElementById('frame2');
const open1 = document.getElementById('open1');
const open2 = document.getElementById('open2');
const openBoth = document.getElementById('openBoth');
const throttleToggle = document.getElementById('throttleToggle');
const explainBtn = document.getElementById('explain');
const downloadBtn = document.getElementById('download');
const status = document.getElementById('status');
const notes = document.getElementById('notes');

open1.addEventListener('click', ()=> {
  const w = window.open();
  w.document.write(frame1.srcdoc);
  w.document.close();
});
open2.addEventListener('click', ()=> {
  const w = window.open();
  w.document.write(frame2.srcdoc);
  w.document.close();
});
openBoth.addEventListener('click', ()=> {
  const w1 = window.open();
  w1.document.write(frame1.srcdoc);
  w1.document.close();
  const w2 = window.open();
  w2.document.write(frame2.srcdoc);
  w2.document.close();
});

let throttleOn = false;
throttleToggle.addEventListener('click', ()=> {
  throttleOn = !throttleOn;
  throttleToggle.textContent = throttleOn ? 'Disable simple host throttle' : 'Enable simple host throttle';
  status.textContent = throttleOn ? 'Throttle enabled — sending pause message to iframes' : 'Throttle disabled';
  // Send a simple postMessage to iframes. If the embedded apps listen for this,
  // they can pause their fetch loops. If not, this is a gentle hint only.
  frame1.contentWindow.postMessage({type:'host-throttle', enabled: throttleOn}, '*');
  frame2.contentWindow.postMessage({type:'host-throttle', enabled: throttleOn}, '*');
});

explainBtn.addEventListener('click', ()=> {
  notes.style.display = notes.style.display === 'none' ? 'block' : 'none';
});

downloadBtn.addEventListener('click', ()=> {
  // download the merged file (this file)
  const url = location.href;
  // create a blob from the full HTML and prompt download
  fetch(url).then(r=>r.text()).then(t=>{
    const blob = new Blob([t], {type:'text/html'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'merged_ema_blowoff.html';
    document.body.appendChild(a);
    a.click();
    a.remove();
    status.textContent = 'Downloaded merged_ema_blowoff.html';
  });
});

// also forward host-throttle messages from parent to children and vice versa
window.addEventListener('message', (ev)=> {
  // noop for now
});
</script>
</body>
</html>
